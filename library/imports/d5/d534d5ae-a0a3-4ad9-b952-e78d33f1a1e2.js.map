{"version":3,"sources":["../../../../../assets/TypeScript/System/assets/TypeScript/System/SceneManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../assets/TypeScript/System","sourcesContent":["// Learn TypeScript:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst {ccclass, property} = cc._decorator;\nimport Scene from \"./Scene\";\n@ccclass\nexport default class SceneManager extends cc.Component {\n    stack:string[] = [];\n    cache:Map<string, Scene> = new Map<string, Scene>();\n    curScene:Scene = null;\n    static ins:SceneManager = null;\n    @property\n    firstScene:string = \"\";\n    @property(cc.BlockInputEvents)\n    blockInput:cc.BlockInputEvents = null;\n    onLoad(){\n        SceneManager.ins = this;\n        this.Enter(this.firstScene, null, ShiftFunc.simpleShift);\n        this.blockInput.enabled = false;\n    }\n    public Enter(sceneName:string, callback:(t:Scene)=>void = null, shiftFunc = ShiftFunc.moveLeftShift){\n        this.loadScene(sceneName).then((newScene:Scene)=>{\n            this.stack.push(sceneName);\n            if(callback){\n                callback(newScene);   \n            }\n            this.blockInput.enabled = true;\n            shiftFunc(this.curScene, newScene, ()=>{\n                this.blockInput.enabled = false;\n            });\n            this.curScene = newScene;\n            this.printState();\n        })\n    }\n    public Back(callback:(t:Scene)=>void = null, shiftFunc = ShiftFunc.moveRightShift){\n        if(this.stack.length>=2){\n            this.stack.pop();\n            let lastScene = this.stack[this.stack.length-1];\n            this.loadScene(lastScene).then((lastScene:Scene)=>{\n                if(callback){\n                    callback(lastScene);   \n                }\n                this.blockInput.enabled = true;\n                shiftFunc(this.curScene, lastScene, ()=>{\n                    this.blockInput.enabled = false;\n                });\n                this.curScene = lastScene;\n                this.printState();\n            })\n        }else{\n            console.log(\"this.stack.length == 0\");\n        }\n    }\n    private loadScene(sceneName:string){\n        return new Promise((reslove, reject)=>{\n            let scene = this.cache.get(sceneName);\n            if(scene){\n                reslove(scene);\n            }else{\n                cc.loader.loadRes(\"Scene/\"+sceneName+\"/\"+sceneName, (err, prefab) => {\n                    var newNode:cc.Node = cc.instantiate(prefab);\n                    newNode.name = sceneName;\n                    newNode.position = cc.Vec2.ZERO;\n                    newNode.active = false;\n                    scene = newNode.getComponent(Scene);\n                    if(scene){\n                        this.node.addChild(scene.node, 0);\n                        this.cache.set(sceneName, scene);\n                        reslove(scene);\n                    }else{\n                        reject();\n                    }\n                });\n            }\n        });\n    }\n    private printState(){\n        let str = \"==========SceneManager=========\\nstack: \";\n        for(let i=0; i<this.stack.length; i++){\n            str += \" >> \"+this.stack[i];\n        }\n        str+=\"\\ncache: \";\n        this.cache.forEach((v, k)=>{\n            str+=v.name+\", \"\n        })\n        str+=\"\\ncurrent: \" + this.curScene?this.curScene.name:\"null\";\n        console.log(str);\n    }\n}\n\n\n\n\nnamespace ShiftFunc{\n    export function simpleShift(curScene:Scene, newScene:Scene, finish){\n        if(curScene){\n            curScene.node.active = false;\n            console.log(curScene.name +\" false\");\n        }\n        if(newScene){\n            newScene.node.active = true;\n            console.log(newScene.name +\" true\");\n        }\n        finish();\n    }\n    export function moveLeftShift(curScene:Scene, newScene:Scene, finish){\n        if(curScene){\n            curScene.node.position = cc.v2(0, 0);\n            cc.tween(curScene.node).to(0.5, {position: cc.v2(-640, 0)}, { easing: 'quintOut'}).call(()=>{\n                curScene.node.active = false;\n            }).start();\n        }\n        if(newScene){\n            newScene.node.position = cc.v2(640, 0);\n            newScene.node.active = true;\n            cc.tween(newScene.node).to(0.5, {position: cc.v2(0, 0)}, { easing: 'quintOut'}).call(()=>{\n                finish();\n            }).start();\n        }\n    }\n    export function moveRightShift(curScene:Scene, newScene:Scene, finish){\n        if(curScene){\n            curScene.node.position = cc.v2(0, 0);\n            cc.tween(curScene.node).to(0.5, {position: cc.v2(640, 0)}, { easing: 'quintOut'}).call(()=>{\n                curScene.node.active = false;\n            }).start();\n        }\n        if(newScene){\n            newScene.node.position = cc.v2(-640, 0);\n            newScene.node.active = true;\n            cc.tween(newScene.node).to(0.5, {position: cc.v2(0, 0)}, { easing: 'quintOut'}).call(()=>{\n                finish();\n            }).start();\n        }\n    }\n    export function scaleShift(curScene:Scene, newScene:Scene, finish){\n        if(curScene){\n            curScene.node.scale = 1;\n            cc.tween(curScene.node).to(1000,{scale:0}).call(()=>{\n                curScene.node.active = false;\n            });\n        }\n        if(newScene){\n            curScene.node.scale = 0;\n            newScene.node.active = true;\n            cc.tween(newScene.node).delay(1000).to(1000,{scale:1}).call(()=>{\n                finish();\n            });\n        }\n    }\n}"]}